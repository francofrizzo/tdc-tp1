% -*- root: ../informe.tex -*-

\section{Resultados}

\newread\tmp

\openin\tmp=../exp/shopping.s.entropy
\read\tmp to \ShoppingSEntropy
\closein\tmp

\openin\tmp=../exp/shopping.s1.entropy
\read\tmp to \ShoppingSOneEntropy
\closein\tmp

\openin\tmp=../exp/starbucks.s.entropy
\read\tmp to \StarbucksSEntropy
\closein\tmp

\openin\tmp=../exp/starbucks.s1.entropy
\read\tmp to \StarbucksSOneEntropy
\closein\tmp

\openin\tmp=../exp/wired_lan.s.entropy
\read\tmp to \WiredLanSEntropy
\closein\tmp

\openin\tmp=../exp/wired_lan.s1.entropy
\read\tmp to \WiredLanSOneEntropy
\closein\tmp

\subsection{Escenario 1 (Red cableada)}

Esta captura se realizó en los laboratorios del Departamento de Computación de la FCEyN, a través de una conexión Ethernet con el switch de un laboratorio.

\subsubsection{Fuente S}

En esta red, se capturaron muchos más paquetes broadcast que unicast. Se puede ver en la figura \ref{res:esc1:fig1}
que los paquetes unicast aportan más información que los broadcast. Esto se explica porque se trata de una red switcheada. Por lo tanto, los paquetes unicast que tienen como destino otros hosts, no llegan al equipo de captura. Sin embargo, como en la red hay una cantidad elevada de hosts (207), se captura una gran cantidad de broadcasts. Como el equipo de captura no se usó para generar una cantidad relevante de tráfico, se capturó más tráfico broadcast de la red, que el tráfico unicast proveniente o destinado a nuestro host de captura.

% ¿La entropía de la fuente S es máxima? ¿Que sugiere esto acerca de la red? ¿Está relacionado con el overhead impuesto por la red debido a los protocolos de control (i.e.: ARP)?

Como es posible observar en la Figura \ref{res:esc1:fig1}, la entropía de la fuente S no es máxima.


\begin{figure}[h]
	\figdef[dim]{figures/wired_lan_s_fig}
	%\caption{Cantidad de información por símbolo y entropía de S en red cableada.}
    \label{res:esc1:fig1}
\end{figure}

En la figura \ref{res:esc1:fig2} se muestra un grafo de la red de mensajes ARP que subyace en esta red. Es notable que el grafo no es conexo, sino que se encuentran varias componentes conexas. Esto se debe a que si bien cada laboratorio tiene su propia subred, están todas en la misma VLAN, y por ende, en el mismo broadcast domain (capa 2). La subred de cada laboratorio es 10.2.X.0/24, donde X es el número de laboratorio, y el gateway de cada red es 10.2.X.254. Como vemos en el gráfico, cada componente conexa se corresponde con cada laboratorio, donde las distintas PCs se conectan con el gateway de esa subred.

También inferimos (a partir de los OUI de las MAC addresses) que las subredes 10.2.20X.0/24 son de los Access Points de los laboratorios.

% ¿Cómo es el tráfico ARP en la red? ¿Se pueden distinguir nodos? ¿Cuántos? ¿Indica algo la cantidad? 
% ¿Se les puede adjudicar alguna función específica? ¿Hay evidencia parcial que sugiera que algún nodo
% funciona de forma anómala y/o no esperada?

%¿Existe una correspondencia entre lo que se conoce de la red y los nodos distinguidos detectados por
%la herramienta? ¿Es posible usar el criterio de distinción propuesto como método para descubrir el/los
%Default Gateway/s de la red? ¿Es preciso?

\begin{figure}[H]
    \figdef[dim]{figures/wired_lan_arp_fig}
    \caption{Red de mensajes \texttt{ARP} para captura de red cableada.}
    \label{res:esc1:fig2}
\end{figure}

% Dada la fuente S1, mostrar la cantidad de información de cada símbolo comparando con la entropía de la fuente.

\begin{figure}[h]
	\figdef[dim]{figures/wired_lan_s1_fig}
	\caption{Cantidad de información por símbolo y entropía de $\mathcal{S}_1$.}
    \label{res:esc1:fig3}
\end{figure}




\subsection{Escenario 2 (\emph{Shopping})}

La principal motivación para estudiar esta red fue poder observar un medio con
mucha actividad, el hecho de que se tratara de una red inalámbrica permitió además
contrastar las diferencias frente a la primer captura sobre una red cableada.

Primero se analizarán los resultados obtenidos para la fuente $\mathcal{S}$.

\begin{figure}[h]
	\figdef[dim]{figures/shopping_s_fig}
	\caption{Cantidad de información por símbolo y entropía de $\mathcal{S}$.}
    \label{res:esc2:fig1}
\end{figure}


Como es posible observar en la Figura \ref{res:esc2:fig1} la entropía de
$\mathcal{S}$ no es máxima. La misma posee un valor relativamente inferior lo
cual indica que la fuente es bastante predecible. Se puede apreciar cómo la
cantidad de información que aporta $s_{\texttt{UNICAST}}$ es mínima con respecto
a $s_{\texttt{BROADCAST}}$. Esto se debe al bajo número de paquetes con destino
broadcast en la red.

Una posible hipótesis a este resultado es el hecho de que se trate de la red
inalámbrica de un centro comercial. Es razonable asumir que los hosts conectados
a la misma más que comunicarse entre ellos estarán accediendo mediante el
gateway a Internet.

Para ello, los mismos necesitan la dirección física asociada a la dirección
\texttt{IP} del gateway. Aquí es donde entra en juego \texttt{ARP}, donde los
hosts a través de mensajes broadcast \texttt{WHO-HAS} consultan por ella. Cuando
este mensaje llega al default gateway además de responder con su dirección
física a cada host que consultó por él, el dispositivo guarda la asociación
entre la dirección \texttt{IP} que originó el mensaje junto a su dirección física.

De esta manera, en un principio los únicos mensajes broadcast presentes son los
que resultan de los paquetes \texttt{ARP} generados por los hosts con el fin de
tener la dirección física del gateway. Una vez hecho esto, el gateway ya conoce
a los hosts por lo tanto cualquier comunicación entre ambos resulta en un
intercambio de paquetes unicast.

Habiendo dicho esto, asumiendo que la hipótesis es cierta, sería correcto
afirmar que existe una relación entre los protocolos de control como
\texttt{ARP} y la fuente $\mathcal{S}$. Si hubiera habido comunicación entre los
nodos de la red entonces el número de broadcasts habría sido necesariamente
mayor dado que en lugar de sólo consultar por la dirección física del gateway
también se lo habría hecho por el resto de los hosts.

A continuación se analizarán los resultados obtenidos para la fuente
$\mathcal{S}_1$.

\begin{figure}[h]
	\figdef[dim]{figures/shopping_s1_fig}
	\caption{Cantidad de información por símbolo y entropía de $\mathcal{S}_1$.}
    \label{res:esc2:fig2}
\end{figure}

Estudiando el tráfico \texttt{ARP} de la captura de esta red se notaron algunas
características que merecen ser mencionadas. La primera es que corroborando la
hipótesis sugerida en el análisis anterior, los mensajes del tipo
\texttt{WHO-HAS} iban todos dirigidos al gateway de la red. La segunda,
fuertemente relacionada con la primera, es el hecho de que el gateway es el
único generando respuestas \texttt{IS-AT} a los hosts y prácticamente no realiza
ningún pedido \texttt{WHO-HAS}.

Ambos comportamientos pueden ser justificados con la hipótesis sobre el tipo de
comunicaciones que se establecen en una red inalámbrica dentro de un centro
comercial. Además, buscando información sobre los routers inalámbricos
utilizados para este tipo de instalaciones se encontró que el \emph{timeout} de
las tablas \texttt{ARP} puede llegar a valores de hasta 4 horas. Esto tiene
sentido puesto que estos dispositivos tienen la capacidad de almacenamiento
necesaria para no tener que preocuparse por quedarse sin espacio para las
entradas.

El modelo utilizado para la fuente $\mathcal{S}_1$ dio un total de 30 nodos en la
red. En la Figura \ref{res:esc2:fig2} se muestran los primeros 20 ordenados por
la cantidad de información que brindan, donde se puede apreciar como hay un
único dispositivo cuyo nivel de información está por debajo del de la entropía
calculada.

Este nodo distinguido resulta ser el gateway de la red estudiada. Su bajo aporte
de información tiene sentido puesto que con el modelo utilizado por cada mensaje
\texttt{WHO-HAS} que lo tenga como destino u origen aumenta la probabilidad de
ocurrencia de su símbolo. Por todo lo discutido anteriormente esto
necesariamente lo vuelve el símbolo con mayor probabilidad de aparición y como
consecuencia el que menor información aporta.

Por último, en la Figura \ref{res:esc2:fig3} se tiene la visualización del
tráfico \texttt{ARP} donde el tamaño de los nodos es proporcional a la
probabilidad de sus símbolos en la fuente $\mathcal{S}_1$. Aquí queda más que
evidente el rol de gateway del nodo distinguido, donde todo el tráfico del
protocolo es entre los hosts y el mismo.

Con respecto a la posibilidad de utilizar esta fuente como método para encontrar
los default gateways, como en este caso resultó efectivo uno podría verse
tentado a decir que el mismo es efectivo en la tarea. Sin embargo, existen muchos
factores que podrían llegar a alterar los resultados obtenidos generando
conclusiones incongruentes. Por ejemplo, la captura sobre la cual se realizó
todo este estudio fue hecha en un punto donde llegaba la señal de un único
\emph{access point}. Si hubieran habido más de estos, dependiendo dónde se
realizaba físicamente la captura se habrían obtenido más o menos paquetes
dirigidos a los mismos. Por lo tanto podría haber ocurrido que habiendo dos
default gateways por el simple hecho de que no llegaran a capturarse suficientes
paquetes dirigidos a uno de ellos el símbolo representando al mismo tuviera una
probabilidad asociada muy baja generando entonces mucha información en la fuente
$\mathcal{S}_1$ quedando por encima de la entropía calculada.

\begin{figure}[h!]
	\figdef[dim]{figures/shopping_arp_fig}
    \caption{Red de mensajes \texttt{ARP} para captura del shopping.}
    \label{res:esc2:fig3}
\end{figure}

\vfill % used to avoid funny stretching between paragraphs

\subsection{Escenario 3 (\emph{Starbucks})}

Esta captura se realizó en la red pública de \emph{WiFi} de un café del centro
de Buenos Aires. Durante el lapso de la captura, los usuarios de la red no
fueron demasiados, lo cual se refleja en la menor cantidad de nodos detectados
en comparación con los escenarios anteriores. No obstante, se encontraron
resultados interesantes, ya que se observaron varias anomalías en los datos
que, gracias a la menor cantidad de hosts, fueron más sencillas de detectar y
estudiar; según se pudo observar, estas se produjeron tanto por
comportamientos anómalos de algunos hosts, como por la interferencia de
paquetes procedentes de una red distinta.

\subsubsection{Fuente $\mathcal{S}$}

Como puede observarse en la Figura \ref{res:esc3:fig1}, los resultados
obtenidos para la fuente $\mathcal{S}$ son similares a los observados para el
escenario del \emph{shopping}: los paquetes de tipo \emph{broadcast} aportan
una cantidad considerable de información, evidenciando que son relativamente
menos frecuentes que los de tipo \emph{unicast}. Esto se puede explicar por
diversos motivos.

Por un lado, como se trata de una red de WiFi pública, es posible capturar los
paquetes de tipo \emph{unicast} dirigidos hacia cualquiera de sus
\emph{hosts}; esto se puede contrastar con lo que sucede en el caso de la red
cableada, donde el \emph{switching} impide capturar los de otros destinos.
Además, también debido al carácter público de la red, los paquetes de tipo
\emph{broadcast} se utilizan en general para protocolos de control (como
\texttt{ARP}), y estos no producen demasiado \emph{overhead}, ya que las
comunicaciones en general se dan exclusivamente entre el \emph{default gateway}
y los demás nodos.

\begin{figure}[H]
    \figdef[dim]{figures/starbucks_s_fig}
    \caption{Cantidad de información por símbolo y entropía de $\mathcal{S}$.}
    \label{res:esc3:fig1}
\end{figure}

En cuanto a la entropía de la fuente $\mathcal{S}$, se observa que esta está
relativamente lejos de ser máxima. La razón es, de nuevo, la abundancia de
paquetes de tipo \emph{unicast}, que vuelve a la fuente bastante predecible.

\subsubsection{Fuente $\mathcal{S}_1$}

\begin{figure}[H]
    \figdef[dim]{figures/starbucks_arp_fig}
    \caption{Red de mensajes \texttt{ARP} para captura del \emph{Starbucks}.}
    \label{res:esc3:fig3}
\end{figure}

\begin{figure}[H]
    \figdef[dim]{figures/starbucks_s1_fig}
    \caption{Cantidad de información por símbolo y entropía de $\mathcal{S}_1$.}
    \label{res:esc3:fig2}
\end{figure}
